From 4a5f23fbf79babd3224469d281e80080c9bc68e2 Mon Sep 17 00:00:00 2001
From: Henry Schreiner <henryschreineriii@gmail.com>
Date: Sun, 26 Jan 2020 17:10:41 -0500
Subject: [PATCH] Ordering thrust

---
 CMakeLists.txt | 12 ++++++++----
 1 file changed, 8 insertions(+), 4 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 40357e34e..bb82b3729 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -440,13 +440,17 @@ if(NOT THRUST_FOUND)
     set(THRUST_INCLUDE_DIR "${GOOFIT_SOURCE_DIR}/extern/thrust")
     find_package(Thrust 1.8 REQUIRED)
 endif()
-message(STATUS "Using Thrust from ${THRUST_INCLUDE_DIRS}")
 
-option(GOOFIT_FORCE_LOCAL_THRUST "GooFit will use the GitHub version of Thrust by default (CUDA 9.2's Thrust is buggy)" ON)
+option(GOOFIT_FORCE_LOCAL_THRUST "GooFit will use the GitHub version of Thrust by default (CUDA 9 and 10's Thrust is buggy)" ON)
 if(GOOFIT_FORCE_LOCAL_THRUST)
-    target_include_directories(GooFit_Common SYSTEM INTERFACE "${GOOFIT_SOURCE_DIR}/extern/thrust")
+    message(STATUS "Forcing local thrust - Requires CUDA < 10.2")
+    message(STATUS "Using CUDA from ${THRUST_INCLUDE_DIRS}")
+    target_include_directories(GooFit_Common SYSTEM BEFORE INTERFACE "${GOOFIT_SOURCE_DIR}/extern/thrust")
+    target_include_directories(GooFit_Common SYSTEM INTERFACE "${THRUST_INCLUDE_DIRS}")
+else()
+    target_include_directories(GooFit_Common SYSTEM INTERFACE "${THRUST_INCLUDE_DIRS}")
+    message(STATUS "Using Thrust and CUDA from ${THRUST_INCLUDE_DIRS}")
 endif()
-target_include_directories(GooFit_Common SYSTEM INTERFACE "${THRUST_INCLUDE_DIRS}")
 
 if(GOOFIT_DEVICE STREQUAL OMP OR GOOFIT_HOST STREQUAL OMP OR GOOFIT_DEVICE STREQUAL TBB OR GOOFIT_HOST STREQUAL TBB)
     find_modern_package(OpenMP)
